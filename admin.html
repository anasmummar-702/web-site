<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | Royal Collections</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js"></script>
    <style>body { background-color: #f8fafc; }</style>
</head>
<body>
    <div id="admin-login-screen" class="modal-overlay open" style="display:flex;">
        <div class="modal-content" style="max-width: 400px; padding: 40px;">
            <h3 style="margin-bottom: 30px; font-family: var(--font-heading); text-align: center; color: var(--color-primary);">Admin Portal</h3>
            <form id="admin-login-form">
                <div class="control-group">
                    <label class="control-label">Email</label>
                    <input type="email" id="admin-email" class="select-input" required placeholder="admin@royalcollections.com">
                </div>
                <div class="control-group">
                    <label class="control-label">Password</label>
                    <input type="password" id="admin-password" class="select-input" required placeholder="••••••••">
                </div>
                <button type="submit" id="admin-login-btn" class="btn btn-primary" style="width: 100%; margin-top: 10px;">Sign In</button>
                <div id="login-error-message" style="color:var(--color-error); text-align:center; margin-top:15px; font-size:0.85rem;"></div>
            </form>
        </div>
    </div>
    
    <header class="admin-main-header">
        <div class="admin-main-header-content">
            <div class="brand-logo"><a href="index.html"><h1>Royal Admin</h1></a></div>
            <div class="header-actions">
                <a href="index.html" class="btn btn-sm btn-ghost">Storefront</a>
                <button id="admin-logout-btn" class="btn btn-sm btn-ghost" onclick="handleAdminLogout()" style="display:none; color: var(--color-error);"><i class="fas fa-power-off"></i></button>
            </div>
        </div>
    </header>

    <div id="admin-dashboard-content" style="display: none;">
        <div class="admin-container">
            <div class="admin-sidebar-nav">
                <button class="nav-tab active" onclick="switchAdminTab('orders-section')"><i class="fas fa-shopping-bag"></i> Orders</button>
                <button class="nav-tab" onclick="switchAdminTab('products-list-section')"><i class="fas fa-tshirt"></i> Products</button>
                <button class="nav-tab action-tab" onclick="switchAdminTab('product-add-section'); resetProductForm();"><i class="fas fa-plus"></i> Add New</button>
            </div>

            <div class="admin-content-area">
                <div id="orders-section" class="admin-section active">
                    <div class="section-header">
                        <h2>Order Management</h2>
                        <div class="search-bar">
                            <i class="fas fa-search"></i>
                            <input type="text" id="order-search-input" placeholder="Search ID, Name, Phone..." onkeyup="filterOrdersLocal()">
                        </div>
                    </div>
                    <div id="admin-orders-grid" class="admin-card-grid">
                        <div class="empty-state">Loading orders...</div>
                    </div>
                </div>

                <div id="products-list-section" class="admin-section" style="display: none;">
                    <div class="section-header">
                        <h2>Product Inventory</h2>
                    </div>
                    <div class="table-container">
                        <table class="modern-table">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th>Category</th>
                                    <th>Stock</th>
                                    <th style="text-align: right;">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="admin-products-body"></tbody>
                        </table>
                    </div>
                </div>

                <div id="product-add-section" class="admin-section" style="display: none;">
                    <div class="section-header">
                        <h2 id="form-heading">Add New Product</h2>
                        <button class="btn btn-sm btn-outline-dark" onclick="switchAdminTab('products-list-section')">Cancel</button>
                    </div>
                    
                    <form id="product-form" class="admin-form">
                        <input type="hidden" id="prod-id">
                        
                        <div class="form-row">
                            <div class="control-group">
                                <label class="control-label">Product Name</label>
                                <input type="text" id="prod-name" class="select-input" required placeholder="Product Title">
                            </div>
                            <div class="control-group">
                                <label class="control-label">Category</label>
                                <select id="prod-category" class="select-input" required>
                                    <option value="ladies">Ladies Couture</option>
                                    <option value="kids">Little Royals</option>
                                    <option value="shoes">Footwear</option>
                                    <option value="cosmetics">Jewelry</option>
                                    <option value="innerwears">Innerwears</option>
                                </select>
                            </div>
                        </div>

                        <div class="control-group">
                            <label class="control-label">Description</label>
                            <textarea id="prod-desc" class="select-input" rows="3" placeholder="Product details..."></textarea>
                        </div>

                        <div class="variants-section-header">
                            <h3>Variants & Inventory</h3>
                            <p>Add options like Color or Style. Each option can have its own image gallery and size list.</p>
                        </div>

                        <div id="variants-container"></div>

                        <button type="button" class="btn btn-dashed" onclick="addVariantBlock()">
                            <i class="fas fa-plus-circle"></i> Add Another Variant (Color/Style)
                        </button>

                        <div class="form-footer">
                            <button type="submit" id="save-product-btn" class="btn btn-primary btn-lg">Save Product</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <template id="variant-block-template">
        <div class="variant-block">
            <div class="variant-header">
                <span class="drag-handle"><i class="fas fa-grip-lines"></i></span>
                <div class="control-group" style="margin:0; flex-grow:1;">
                    <input type="text" class="variant-name-input select-input" required placeholder="Variant Name (e.g. Red, Striped)">
                </div>
                <button type="button" class="btn-icon delete" onclick="this.closest('.variant-block').remove()"><i class="fas fa-trash-alt"></i></button>
            </div>

            <div class="variant-body">
                <div class="control-group">
                    <label class="control-label">Gallery Images</label>
                    <div class="file-upload-wrapper">
                        <input type="file" class="variant-image-input" accept="image/*" multiple>
                        <span class="upload-label"><i class="fas fa-cloud-upload-alt"></i> Choose Images</span>
                    </div>
                    <div class="variant-img-preview"></div>
                    <input type="hidden" class="existing-images-json">
                </div>

                <div class="size-manager">
                    <div class="size-header">
                        <label class="control-label">Sizes & Stock</label>
                        <select class="size-preset-trigger select-input small-select" onchange="applyPresetToRow(this)">
                            <option value="">+ Quick Fill...</option>
                            <option value="ladies_standard">S - 5XL</option>
                            <option value="jeans">Jeans (28-40)</option>
                            <option value="kids">Kids (0-36)</option>
                            <option value="footwear">Shoes (5-9)</option>
                            <option value="bra">Bra (30-42)</option>
                            <option value="inner_other">Other (50-110)</option>
                        </select>
                    </div>
                    
                    <div class="size-table-wrapper">
                        <table class="variant-table">
                            <thead><tr><th>Size</th><th>Price (₹)</th><th>Stock</th><th></th></tr></thead>
                            <tbody class="size-rows-container"></tbody>
                        </table>
                    </div>
                    <button type="button" class="btn btn-sm btn-ghost" onclick="addSizeRow(this.closest('.size-manager').querySelector('tbody'))">+ Add Single Size Row</button>
                </div>
            </div>
        </div>
    </template>

    <script src="script.js"></script>
</body>
</html>